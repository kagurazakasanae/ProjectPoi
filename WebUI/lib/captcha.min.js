self.ProjectPoi = self.ProjectPoi || {};
self.ProjectPoi.CONFIG = {
    LIB_URL: "https://ppoi.org/lib/",
    WEBSOCKET_SHARDS: [
        ["wss://ws01.ppoi.org/proxy"]
    ],
    CAPTCHA_URL: "https://ppoi.org/captcha/",
    MINER_URL: "https://ppoi.org/View/Tpl/miner.html"
};
(function(window) {
    "use strict";
    var Captcha = function(div) {
        this.div = div;
        this.goal = parseInt(this.div.dataset.hashes, 10) || 1024;
        this.key = this.div.dataset.key;
        this.callback = this.div.dataset.callback;
        this.disableSelector = this.div.dataset.disableElements;
        this.autostart = div.dataset.autostart === "true";
        this.whitelabel = div.dataset.whitelabel === "true";
        this.div.innerHTML = "";
        this.iframe = document.createElement("iframe");
        this.iframe.style.width = "304px";
        this.iframe.style.height = "76px";
        this.iframe.style.border = "none";
        this.iframe.src = ProjectPoi.CONFIG.CAPTCHA_URL + "?goal=" + this.goal + "&key=" + this.key + "&autostart=" + (this.autostart ? "1" : "0") + "&whitelabel=" + (this.whitelabel ? "1" : "0");
        this.div.appendChild(this.iframe);
        this.input = document.createElement("input");
        this.input.type = "hidden";
        this.input.name = "projectpoi-captcha-token";
        this.div.appendChild(this.input);
        window.addEventListener("message", this.onMessage.bind(this));
        if (this.disableSelector) {
            var elements = document.querySelectorAll(this.disableSelector);
            for (var i = 0; i < elements.length; i++) {
                elements[i].disabled = true
            }
        }
    };
    Captcha.prototype.onMessage = function(ev) {
        if (ev.source !== this.iframe.contentWindow) {
            return
        }
        if (ev.data.type === "projectpoi-goal-reached" && ev.data.params) {
            this.input.value = ev.data.params.token;
            if (this.callback) {
                var callback = window[this.callback];
                if (typeof callback === "function") {
                    callback(ev.data.params.token)
                }
            }
            if (this.disableSelector) {
                var elements = document.querySelectorAll(this.disableSelector);
                for (var i = 0; i < elements.length; i++) {
                    elements[i].disabled = false
                }
            }
        }
    };
    Captcha.CreateElements = function() {
        var elements = document.querySelectorAll(".projectpoi-captcha");
        for (var i = 0; i < elements.length; i++) {
            new Captcha(elements[i])
        }
    };
    if (document.readyState === "complete" || document.readyState === "interactive") {
        Captcha.CreateElements()
    } else {
        document.addEventListener("readystatechange", function() {
            if (document.readyState === "interactive") {
                Captcha.CreateElements()
            }
        })
    }
    window.ProjectPoi = window.ProjectPoi || {};
    window.ProjectPoi.Captcha = Captcha
})(window);